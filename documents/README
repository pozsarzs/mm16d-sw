Operating program for MM16D device
----------------------------------

1. About software
~~~~~~~~~~~~~~~~~

  It is a stand-alone grow house control device. It takes the environmental data
from the MM17D connected to it via the serial port using Modbus/RTU protocol.
Default serial port parameters for serial console and Modbus/RTU connection: 9600
bps, 8N1. It uploads the received data and the status data of the device to a
remote database, and also retrieves the settings affecting its operation from
there. If this database is not available, it works with the last or a general
setting (if it is after switching on), then the logging is paused.
  It has a web interface. All data can be queried via WLAN using HTTP in four
formats (CSV, JSON, TXT and XML) and using Modbus/TCP.
 
Requirements:
  Hardware: ESP8266 Huzzah Feather microcontroller
  Software: - Modbus-ESP8266 library v4.1.0 by Andre Sarmento Barbosa,
              Alexander Emelianov
            - NTPClient library v3.2.1 by Fabrice Weinberg
            - ESP8266WebServer library v1.0 by Ivan Grokhotkov
            - ESP8266WiFi library v1.0 by Ivan Grokhotkov
            - StringSplitter library v1.0.0 by Harsha Alva

2. Settings
~~~~~~~~~~~
In the 'mm16d.ino' file:

  // settings
  const int     COM_SPEED         = 9600;
  const int     MB_UID            = 1;
  const char   *WIFI_SSID         = "";
  const char   *WIFI_PASSWORD     = "";

3. Serial console output
~~~~~~~~~~~~~~~~~~~~~~~~
The serial console shuts down at the end of the startup process to free the
serial port for Modbus/RTU communication.

MM16D * Grow house controller
  Copyright (C) 2023 Pozsar Zsolt
    software version:       v0.1.0
  Starting device...
  * Initializing GPIO ports
  * Connecting to wireless network.......done
    my MAC address:         80:7D:3A:5D:53:84
    my IP address:          192.168.0.103
    subnet mask:            255.255.255.0
    gateway IP address:     192.168.0.1
  * Starting Modbus/TCP server
  * Starting Modbus/RTU master
    serial port speed:      9600
  * Starting webserver
  * Ready, the serial console is off.
  
4. Information and data access
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
a. Information pages:
  http://../          help                                       text/html
  http://../summary   summary                                    text/html
  http://../log       log                                        text/html

b. Data access with HTTP:
  http://../get/csv   all values in CSV format                   text/plain
  http://../get/json  all values in JSON format                  text/plain
  http://../get/txt   all values in TXT format                   text/plain
  http://../get/xml   all values in XML format                   text/plain

  Output format:
  CSV:
    "name","MM17D"
    "version","0.1.0"
    "mac_address","80:7D:3A:5D:53:84"
    "ip_address","192.168.0.103"
    "modbus_uid","0"
    "com_speed","9600"
    "signlight","1"
    "alarm","0"
    "breaker","0"
    "errorntp","0"
    "errordb","0"
    "errormm17d","0"
    "standby","0"
    "hyphae","0"
    "mushroom","1"
    "manual","0"
    "enalamp","1"
    "enavent","1"
    "enaheater","1"
    "lamp","1"
    "vent","0"
    "heater","0"
    "rhintless","0"
    "rhintmore","0"
    "tintless","0"
    "tintmore","0"
    "mm17dgreen","1"
    "mm17dyellow","0"
    "mm17dred""0"
    "rhint","83"
    "tint","19"
    "text","-2"
 
  TXT:
    MM17D
    0.1.0
    80:7D:3A:5D:53:84
    192.168.0.103
    1
    9600
    1
    0
    0
    0
    0
    0
    0
    0
    1
    0
    1
    1
    1
    1
    0
    0
    0
    0
    0
    0
    1
    0
    0
    83
    19
    -2

  JSON:
    "{
      "software": {
        "name": "MM17D",
        "version": "0.1.0"
      },
      "hardware": {
        "mac_address": "80:7D:3A:5D:53:84",
        "ip_address": "192.168.0.103",
        "modbus_uid": "0",
        "com_speed": "9600"
      },
      "integer": {
        "rhint": "83",
        "tint": "19",
        "text": "-2"
      },
      "bit": {
        "signlight": "1",
        "alarm": "0",
        "breaker": "0",
        "errorntp": "0",
        "errordb": "0",
        "errormm17d": "0",
        "standby": "0",
        "hyphae": "0",
        "mushroom": "1",
        "manual": "0",
        "enalamp": "1",
        "enavent": "1",
        "enaheater": "1",
        "lamp": "1",
        "vent": "0",
        "heater": "0",
        "rhintless": "0",
        "rhintmore": "0",
        "tintless": "0",
        "tintmore": "0",
        "mm17dgreen": "1",
        "mm17dyellow": "0",
        "mm17dred""0"
      }
    }

  XML:
    <xml>
      <software>
        <name>MM17D</name>
        <version>0.1</version>
      </software>
      <hardware>
        <mac_address>80:7D:3A:5D:53:84</mac_address>
        <ip_address>192.168.0.103</ip_address>
        <modbus_uid>0</modbus_uid>
        <com_speed>9600</com_speed>
      </hardware>
      <integer>
        <rhint>83</rhint>
        <tint>19</tint>
        <text>-2</text>
      </integer>
      <bit>
        <signlight>1</signlight>
        <alarm>0</alarm>
        <breaker>0</breaker>
        <errorntp>0</errorntp>
        <errordb>0</errordb>
        <errormm17d>0</errormm17d>
        <standby>0</standby>
        <hyphae>0</hyphae>
        <mushroom>1</mushroom>
        <manual>0</manual>
        <enalamp>1</enalamp>
        <enavent>1</enavent>
        <enaheater>1</enaheater>
        <lamp>1</lamp>
        <vent>0</vent>
        <heater>0</heater>
        <rhintless>0</hintless>
        <rhintmore>0</rhintmore>
        <tintless>0</tintless>
        <tintmore>0</tintmore>
        <mm17dgreen>1</mm17dgreen>
        <mm17dyellow>0</mm17dyellow>
        <mm17dred>0</mm17dred>
      </bit>
    </xml>

c.Data access with Modbus:
  10001               Sign lights              (0/1: red/green)  bit
  10002               Alarm                 (0/1: normal/alarm)  bit
  10003               Overcurrent breaker  (0/1: closed/opened)  bit
  10004               No connection to the NTP server            bit
  10005               No connection to the database server       bit
  10006               No connection to the MM17D                 bit
  10007               Stand-by operation mode                    bit
  10008               Growing hyphae operation mode              bit
  10009               Growing mushroom operation mode            bit
  10010               Manual switch               (0/1: off/on)  bit
  10011               Enable lamps        (0/1: disable/enable)  bit
  10012               Enable ventilators  (0/1: disable/enable)  bit
  10013               Enable heater       (0/1: disable/enable)  bit
  10014               Lamp output                 (0/1: off/on)  bit
  10015               Ventilator output           (0/1: off/on)  bit
  10016               Heater output               (0/1: off/on)  bit
  10017               Internal humidity is less than requied     bit
  10018               Internal humidity is more than requied     bit
  10019               Internal temperature is less than requied  bit
  10020               Internal temperature is more than requied  bit
  10021               MM17D green LED             (0/1: off/on)  bit
  10022               MM17D yellow LED            (0/1: off/on)  bit
  10023               MM17D red LED               (0/1: off/on)  bit

  30001               MM17D int. humidity in percent             integer
  30002               MM17D int. temperature in degree Celsius   integer
  30003               MM17D ext. temperature in degree Celsius   integer

  40001-40008         device name                  8 ASCII coded char
  40009-40011         software versio                          3 byte
  40012-40017         MAC address                              6 byte
  40018-40021         IP address                               4 byte
  40022               always zero                                integer
  40023-40028         serial port speed            6 ASCII coded char

5. How to get installer package?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Visit homepage (see later) to download package:

  architecture  operation system        filename
  --------------------------------------------------------
  (all)         (source code)           mm16d-sw-0.1.tar.gz

Download from Github

  $ git clone https://github.com/pozsarzs/mm16d-sw.git

4. Contact
~~~~~~~~~~
   Homepage:             <http://www.pozsarzs.hu>
   Author:               Pozsar Zsolt
   E-mail:               <pozsarzs@gmail.com>
   Phone:                +36 56/470-272
   Mobile:               +36 30/249-5030

--------------------------------------------------------------------------------
 MM16D * Copyright (C) 2023 Pozsar Zsolt <pozsarzs@gmail.com>
